var SUDOKU={};SUDOKU.game=function(){var t=function(e,l){var i,n;for(e.sortCells(),i=0;i<e.cells.length&&(n=e.cells[i],null!==n.value);i++);if(void 0===n||null!==n.value)return!0;if(0===n.availableValues.length)return!1;var s=[];for(i=0;i<n.availableValues.length;i++)s.push(n.availableValues[i]);for(i=0;i<s.length;i++){var r=s[i];n.setValue(r);var a=t(e,l);if(a)return l&&n.unsetValue(r),!0;n.unsetValue(r)}return!1},e=function(e){return t(e,!0)},l=function(e,l){e.shuffle(new MersenneTwister(l)),t(e,!1)};return{fillBoard:l,canSolve:e}}();var MersenneTwister=function(t){void 0==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(t)};MersenneTwister.prototype.init_genrand=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++)t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0},MersenneTwister.prototype.init_by_array=function(t,e){var l,i,n;for(this.init_genrand(19650218),l=1,i=0,n=this.N>e?this.N:e;n;n--){var s=this.mt[l-1]^this.mt[l-1]>>>30;this.mt[l]=(this.mt[l]^(1664525*((4294901760&s)>>>16)<<16)+1664525*(65535&s))+t[i]+i,this.mt[l]>>>=0,l++,i++,l>=this.N&&(this.mt[0]=this.mt[this.N-1],l=1),i>=e&&(i=0)}for(n=this.N-1;n;n--){var s=this.mt[l-1]^this.mt[l-1]>>>30;this.mt[l]=(this.mt[l]^(1566083941*((4294901760&s)>>>16)<<16)+1566083941*(65535&s))-l,this.mt[l]>>>=0,l++,l>=this.N&&(this.mt[0]=this.mt[this.N-1],l=1)}this.mt[0]=2147483648},MersenneTwister.prototype.genrand_int32=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var l;for(this.mti==this.N+1&&this.init_genrand(5489),l=0;l<this.N-this.M;l++)t=this.mt[l]&this.UPPER_MASK|this.mt[l+1]&this.LOWER_MASK,this.mt[l]=this.mt[l+this.M]^t>>>1^e[1&t];for(;l<this.N-1;l++)t=this.mt[l]&this.UPPER_MASK|this.mt[l+1]&this.LOWER_MASK,this.mt[l]=this.mt[l+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0},MersenneTwister.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},MersenneTwister.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)},MersenneTwister.prototype.random=function(t){return Math.floor(this.genrand_int32()*(1*t/4294967296))},MersenneTwister.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},MersenneTwister.prototype.genrand_res53=function(){var t=this.genrand_int32()>>>5,e=this.genrand_int32()>>>6;return(67108864*t+e)*(1/9007199254740992)},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),l=e.length>>>0;if(0===l)return-1;var i=0;if(arguments.length>0&&(i=Number(arguments[1]),i!=i?i=0:0!=i&&i!=1/0&&i!=-(1/0)&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=l)return-1;for(var n=i>=0?i:Math.max(l-Math.abs(i),0);l>n;n++)if(n in e&&e[n]===t)return n;return-1});var Board=function(){this.cells=[],this.rows=[],this.columns=[],this.blocks=[],this._coords=[]};Board.prototype.init=function(t){for(var e=[],l=0;t>l;l++)e.push(l);for(var i=0;i<this.cells.length;i++){for(var n=this.cells[i],s=0;s<this.rows[n.row].length;s++){var r=this.rows[n.row][s];r!==n&&n.rowCells.push(r)}for(var a=0;a<this.columns[n.column].length;a++){var o=this.columns[n.column][a];o!==n&&n.columnCells.push(o)}for(var h=0;h<this.blocks[n.block].length;h++){var u=this.blocks[n.block][h];u!==n&&n.blockCells.push(u)}n.init(e)}},Board.prototype.addCell=function(t){function e(t,e,l){var i=t[l];i?i[i.length]=e:t[l]=[e]}this.cells[this.cells.length]=t,e(this.rows,t,t.row),e(this.columns,t,t.column),e(this.blocks,t,t.block),this._coords[t.row]||(this._coords[t.row]=[]),this._coords[t.row][t.column]||(this._coords[t.row][t.column]=[]),this._coords[t.row][t.column][t.block]=t},Board.prototype.getCell=function(t,e,l){var i=this._coords[t][e][l];if(!i)throw new Error("Invalid coordinate ("+t+", "+e+", "+l+")");return i},Board.prototype.sortCells=function(){this.cells.sort(function(t,e){return t.availableValues.length-e.availableValues.length})},Board.prototype.shuffle=function(t){for(var e=[],l=this.cells.length,i=0;l>i;i++)e.push(this.cells.splice(t.random(this.cells.length-i),1)[0]);this.cells=e},SUDOKU.board=function(){var t,e=function(e,i){var n=document.getElementById(e);t=new Board;for(var s=n.getElementsByTagName("tr"),r=0;r<s.length;r++)for(var a=s[r].getElementsByTagName("td"),o=0;o<a.length;o++)for(var h=a[o].getElementsByTagName("div"),u=0;u<h.length;u++){var c=h[u],f=c.cloneNode(!1);c.parentNode.replaceChild(f,c),c=f;var v=c.getAttribute("data-block"),m=new Cell(r,o,v);t.addCell(m),c.innerHTML="",m.element=c,l(c,m)}return t.init(i),t},l=function(t,e){t.addEventListener("click",function(){null!==e.displayValue&&(1===e.availableValues.length?n(e):a(e))},!1)},i=function(){for(var e=t.cells.slice(0),l=0;l<e.length;l++){var i=e[l];1===i.availableValues.length&&""==i.element.textContent&&(n(i),s())}},n=function(e){e.setValue(e.originalValue);for(var l=0;l<t.cells.length;l++){var i=t.cells[l];i.element.textContent=i.value}o(),s()},s=function(){for(var e=0;e<t.cells.length;e++)if(void 0==t.cells[e].value)return;u()},r=document.getElementsByClassName("available")[0],a=function(t){if(o(),""===t.element.textContent){for(var e=r.getElementsByTagName("li"),l=0;l<e.length;l++)t.availableValues.indexOf(parseInt(l))>-1?e[l].className+=" enabled":e[l].className+=" disabled";r.cell=t}};!function(){for(var t=r.getElementsByTagName("li"),e=0;e<t.length;e++)t[e].addEventListener("click",function(){var t=this.attributes["class"];t&&t.value.indexOf("disabled")>0||(r.cell&&(r.cell.originalValue===parseInt(this.textContent)?n(r.cell):h()),o())},!1)}();var o=function(){for(var t=r.getElementsByTagName("li"),e=0;e<t.length;e++)t[e].className=t[e].className.replace(" disabled","").replace(" enabled","");try{delete r.cell}catch(l){r.cell=void 0}},h=function(){alert("Wrong move, try again.")},u=function(){alert("Done!")};return{createBoard:e,autoComplete:i}}();var Cell=function(t,e,l){this.row=t,this.column=e,this.block=l,this.value=null,this.numberOfValues=null,this.availableValues=null,this.rowCells=[],this.columnCells=[],this.blockCells=[],this.adjacentCells=[]};Cell.prototype.toString=function(){return"("+this.row+","+this.column+","+this.block+")"},Cell.prototype.setValue=function(t){for(var e=0;e<this.adjacentCells.length;e++)if(this.adjacentCells[e].value===t)throw new Error("Attempting to set an invalid value "+this.toString()+" != "+t);if(this.value)throw new Error("Value aready set");this.value=t;for(var l=0;l<this.adjacentCells.length;l++)this.adjacentCells[l].isNot(t)},Cell.prototype.init=function(t){this.numberOfValues=t.length;var e,l;if(null!==this.availableValues)throw new Error("availableValues aready set");for(this.availableValues=[],e=0;e<t.length;e++)this.availableValues.push(t[e]);for(e=0;e<this.rowCells.length;e++)if(this.adjacentCells.push(this.rowCells[e]),this.rowCells[e].row!==this.row)throw new Error("Cell has incorrect rows");for(e=0;e<this.columnCells.length;e++)if(l=this.columnCells[e],this.adjacentCells.indexOf(l)<0&&this.adjacentCells.push(l),l.column!==this.column)throw new Error("Cell has incorrect columns");for(e=0;e<this.blockCells.length;e++)if(l=this.blockCells[e],this.adjacentCells.indexOf(l)<0&&this.adjacentCells.push(l),l.block!==this.block)throw new Error("Cell has incorrect blocks")},Cell.prototype.isNot=function(t){var e=this.availableValues.indexOf(t);e>-1&&this.availableValues.splice(e,1)},Cell.prototype.couldBe=function(t){this.availableValues.indexOf(t)<0&&this.availableValues.push(t)},Cell.prototype.__containsValue=function(t,e){for(var l=0;l<t.length;l++)if(t[l].value===e)return!0;return!1},Cell.prototype.rowContains=function(t){return this.__containsValue(this.rowCells,t)},Cell.prototype.columnContains=function(t){return this.__containsValue(this.columnCells,t)},Cell.prototype.blockContains=function(t){return this.__containsValue(this.blockCells,t)},Cell.prototype.isTriangle=function(){return this.row==this.column||this.row==7-this.column},Cell.prototype.unsetValue=function(){var t=this.value;this.value=null;for(var e=0;e<this.rowCells.length;e++){var l=this.rowCells[e];l.blockContains(t)||l.columnContains(t)||l.couldBe(t)}for(var i=0;i<this.columnCells.length;i++){var n=this.columnCells[i];n.blockContains(t)||n.rowContains(t)||n.couldBe(t)}for(var s=0;s<this.blockCells.length;s++){var r=this.blockCells[s];r.rowContains(t)||r.columnContains(t)||r.couldBe(t)}var a;this.availableValues=[];for(var o=0;o<this.numberOfValues;o++)this.availableValues.push(o);for(o=0;o<this.adjacentCells.length;o++)if(a=this.adjacentCells[o].value,null!==a){var h=this.availableValues.indexOf(a);h>-1&&this.availableValues.splice(h,1)}};var unFill=function(t,e){for(var l=function(){for(var e=t.cells.slice(0),l=0;l<e.length;l++){var i=e[l];if(!i.isTriangle()&&1===i.availableValues.length&&null!==i.value)return i.unsetValue(),!0}return!1},i=t.cells.slice(0),n=0;n<i.length;n++){var s=i[n];s.originalValue=s.value,s.availableValues=[s.value]}var r=new MersenneTwister(e);for(t.shuffle(r);l(););},unFillSomeMore=function(t,e){function l(t,e,l,i){if(i==l)throw new Error("Testing with original value");if(e.availableValues.indexOf(i)<0)throw new Error("Testing with an invalid value");e.unsetValue(),e.setValue(i);var n=SUDOKU.game.canSolve(t);return e.unsetValue(),e.setValue(l),n}var i,n,s,r,a,o;t.sortCells();var h=t.cells.slice(0);for(i=0;i<h.length;i++)if(s=h[i],!s.isTriangle()&&s.availableValues.length===e&&null!==s.value){r=s.value,o=!1;var u=s.availableValues.slice(0);for(n=0;n<u.length;n++)if(a=u[n],a!==r&&l(t,s,r,a)){o=!0;break}o||s.unsetValue()}};
