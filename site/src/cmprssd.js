if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){"use strict";if(this==null){throw new TypeError}var t=Object(this);var n=t.length>>>0;if(n===0){return-1}var r=0;if(arguments.length>0){r=Number(arguments[1]);if(r!=r){r=0}else if(r!=0&&r!=Infinity&&r!=-Infinity){r=(r>0||-1)*Math.floor(Math.abs(r))}}if(r>=n){return-1}var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++){if(i in t&&t[i]===e){return i}}return-1}}"use strict";var Cell=function(e,t,n){this.row=e;this.column=t;this.block=n;this.value=null;this.numberOfValues=null;this.availableValues=null;this.rowCells=[];this.columnCells=[];this.blockCells=[];this.adjacentCells=[]};Cell.prototype.toString=function(){return"("+this.row+","+this.column+","+this.block+")"};Cell.prototype.setValue=function(e){for(var t=0;t<this.adjacentCells.length;t++){if(this.adjacentCells[t].value===e){throw new Error("Attempting to set an invalid value "+this.toString()+" != "+e)}}if(this.value){throw new Error("Value aready set")}this.value=e;for(var n=0;n<this.adjacentCells.length;n++){this.adjacentCells[n].isNot(e)}};Cell.prototype.init=function(e){this.numberOfValues=e.length;var t,n;if(this.availableValues!==null){throw new Error("availableValues aready set")}this.availableValues=[];for(t=0;t<e.length;t++){this.availableValues.push(e[t])}for(t=0;t<this.rowCells.length;t++){this.adjacentCells.push(this.rowCells[t]);if(this.rowCells[t].row!==this.row){throw new Error("Cell has incorrect rows")}}for(t=0;t<this.columnCells.length;t++){n=this.columnCells[t];if(this.adjacentCells.indexOf(n)<0){this.adjacentCells.push(n)}if(n.column!==this.column){throw new Error("Cell has incorrect columns")}}for(t=0;t<this.blockCells.length;t++){n=this.blockCells[t];if(this.adjacentCells.indexOf(n)<0){this.adjacentCells.push(n)}if(n.block!==this.block){throw new Error("Cell has incorrect blocks")}}};Cell.prototype.isNot=function(e){var t=this.availableValues.indexOf(e);if(t>-1){this.availableValues.splice(t,1)}};Cell.prototype.couldBe=function(e){if(this.availableValues.indexOf(e)<0){this.availableValues.push(e)}};Cell.prototype.__containsValue=function(e,t){for(var n=0;n<e.length;n++){if(e[n].value===t){return true}}return false};Cell.prototype.rowContains=function(e){return this.__containsValue(this.rowCells,e)};Cell.prototype.columnContains=function(e){return this.__containsValue(this.columnCells,e)};Cell.prototype.blockContains=function(e){return this.__containsValue(this.blockCells,e)};Cell.prototype.unsetValue=function(){var e=this.value;this.value=null;for(var t=0;t<this.rowCells.length;t++){var n=this.rowCells[t];if(!n.blockContains(e)&&!n.columnContains(e)){n.couldBe(e)}}for(var r=0;r<this.columnCells.length;r++){var i=this.columnCells[r];if(!i.blockContains(e)&&!i.rowContains(e)){i.couldBe(e)}}for(var s=0;s<this.blockCells.length;s++){var o=this.blockCells[s];if(!o.rowContains(e)&&!o.columnContains(e)){o.couldBe(e)}}var u;this.availableValues=[];for(var a=0;a<this.numberOfValues;a++){this.availableValues.push(a)}for(a=0;a<this.adjacentCells.length;a++){u=this.adjacentCells[a].value;if(u!==null){var f=this.availableValues.indexOf(u);if(f>-1){this.availableValues.splice(f,1)}}}};"use strict";var Board=function(){this.cells=[];this.rows=[];this.columns=[];this.blocks=[];this._coords=[]};Board.prototype.init=function(e){var t=[];for(var n=0;n<e;n++){t.push(n)}for(var r=0;r<this.cells.length;r++){var i=this.cells[r];for(var s=0;s<this.rows[i.row].length;s++){var o=this.rows[i.row][s];if(o!==i){i.rowCells.push(o)}}for(var u=0;u<this.columns[i.column].length;u++){var a=this.columns[i.column][u];if(a!==i){i.columnCells.push(a)}}for(var f=0;f<this.blocks[i.block].length;f++){var l=this.blocks[i.block][f];if(l!==i){i.blockCells.push(l)}}i.init(t)}};Board.prototype.addCell=function(e){function t(e,t,n){var r=e[n];if(!r){e[n]=[t]}else{r[r.length]=t}}this.cells[this.cells.length]=e;t(this.rows,e,e.row);t(this.columns,e,e.column);t(this.blocks,e,e.block);if(!this._coords[e.row]){this._coords[e.row]=[]}if(!this._coords[e.row][e.column]){this._coords[e.row][e.column]=[]}this._coords[e.row][e.column][e.block]=e};Board.prototype.getCell=function(e,t,n){var r=this._coords[e][t][n];if(!r){throw new Error("Invalid coordinate ("+e+", "+t+", "+n+")")}return r};Board.prototype.sortCells=function(){this.cells.sort(function(e,t){return e.availableValues.length-t.availableValues.length})};Board.prototype.shuffle=function(e){var t=[];var n=this.cells.length;for(var r=0;r<n;r++){t.push(this.cells.splice(e.random(this.cells.length-r),1)[0])}this.cells=t};var MersenneTwister=function(e){if(e==undefined){e=(new Date).getTime()}this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=new Array(this.N);this.mti=this.N+1;this.init_genrand(e)};MersenneTwister.prototype.init_genrand=function(e){this.mt[0]=e>>>0;for(this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti;this.mt[this.mti]>>>=0}};MersenneTwister.prototype.init_by_array=function(e,t){var n,r,i;this.init_genrand(19650218);n=1;r=0;i=this.N>t?this.N:t;for(;i;i--){var s=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((s&4294901760)>>>16)*1664525<<16)+(s&65535)*1664525)+e[r]+r;this.mt[n]>>>=0;n++;r++;if(n>=this.N){this.mt[0]=this.mt[this.N-1];n=1}if(r>=t)r=0}for(i=this.N-1;i;i--){var s=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((s&4294901760)>>>16)*1566083941<<16)+(s&65535)*1566083941)-n;this.mt[n]>>>=0;n++;if(n>=this.N){this.mt[0]=this.mt[this.N-1];n=1}}this.mt[0]=2147483648};MersenneTwister.prototype.genrand_int32=function(){var e;var t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;if(this.mti==this.N+1)this.init_genrand(5489);for(n=0;n<this.N-this.M;n++){e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK;this.mt[n]=this.mt[n+this.M]^e>>>1^t[e&1]}for(;n<this.N-1;n++){e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK;this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[e&1]}e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK;this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1];this.mti=0}e=this.mt[this.mti++];e^=e>>>11;e^=e<<7&2636928640;e^=e<<15&4022730752;e^=e>>>18;return e>>>0};MersenneTwister.prototype.genrand_int31=function(){return this.genrand_int32()>>>1};MersenneTwister.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)};MersenneTwister.prototype.random=function(e){return Math.floor(this.genrand_int32()*(e*1/4294967296))};MersenneTwister.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)};MersenneTwister.prototype.genrand_res53=function(){var e=this.genrand_int32()>>>5,t=this.genrand_int32()>>>6;return(e*67108864+t)*(1/9007199254740992)};var SUDOKU={};SUDOKU.game=function(){var e=function(t,n){var r,i;t.sortCells();for(r=0;r<t.cells.length;r++){i=t.cells[r];if(i.value===null){break}}if(i===undefined||i.value!==null){return true}if(i.availableValues.length===0){return false}var s=[];for(r=0;r<i.availableValues.length;r++){s.push(i.availableValues[r])}for(r=0;r<s.length;r++){var o=s[r];i.setValue(o);var u=e(t,n);if(!u){i.unsetValue(o)}else{if(n){i.unsetValue(o)}return true}}return false};var t=function(t){return e(t,true)};var n=function(t,n){t.shuffle(new MersenneTwister(n));e(t,false)};return{fillBoard:n,canSolve:t}}();var unFill=function(e,t){var n=function(){var t=e.cells.slice(0);for(var n=0;n<t.length;n++){var r=t[n];if(r.availableValues.length===1&&r.value!==null){r.unsetValue();return true}}return false};var r=e.cells.slice(0);for(var i=0;i<r.length;i++){var s=r[i];s.originalValue=s.value;s.availableValues=[s.value]}var o=new MersenneTwister(t);e.shuffle(o);while(n()){}};var unFillSomeMore=function(e,t){function n(e,t,n,r){if(r==n){throw new Error("Testing with original value")}if(t.availableValues.indexOf(r)<0){throw new Error("Testing with an invalid value")}t.unsetValue();t.setValue(r);var i=SUDOKU.game.canSolve(e);t.unsetValue();t.setValue(n);return i}var r,i,s,o,u,a;e.sortCells();var f=e.cells.slice(0);for(r=0;r<f.length;r++){s=f[r];if(s.availableValues.length===t&&s.value!==null){o=s.value;a=false;var l=s.availableValues.slice(0);for(i=0;i<l.length;i++){u=l[i];if(u!==o&&n(e,s,o,u)){a=true;break}}if(!a){s.unsetValue()}}}};SUDOKU.controls=function(){var e="Medium";var t=document.getElementsByClassName("difficulty")[0];var n=t.getElementsByTagName("li");for(var r=0;r<n.length;r++){n[r].addEventListener("click",function(){var t=this.attributes["class"];if(t&&t.value.indexOf("enabled")>0){return}i();this.className="enabled";e=this.textContent;startGame(e)},false)}var i=function(){var e=t.getElementsByTagName("li");for(var n=0;n<e.length;n++){e[n].className=""}};return{difficulty:function(){return e}}}();SUDOKU.board=function(){var e;var t=function(t,r){var i=document.getElementById(t);e=new Board;var s=i.getElementsByTagName("tr");for(var o=0;o<s.length;o++){var u=s[o].getElementsByTagName("td");for(var a=0;a<u.length;a++){var f=u[a].getElementsByTagName("div");for(var l=0;l<f.length;l++){var c=f[l];var h=c.cloneNode(false);c.parentNode.replaceChild(h,c);c=h;var p=c.getAttribute("data-block");var d=new Cell(o,a,p);e.addCell(d);c.innerHTML="";d.element=c;n(c,d)}}}e.init(r);return e};var n=function(e,t){e.addEventListener("click",function(){if(t.displayValue!==null){if(t.availableValues.length===1){i(t)}else{u(t)}}},false)};var r=function(){var t=e.cells.slice(0);for(var n=0;n<t.length;n++){var r=t[n];if(r.availableValues.length===1&&r.element.textContent==""){i(r);s()}}};var i=function(t){t.setValue(t.originalValue);for(var n=0;n<e.cells.length;n++){var r=e.cells[n];r.element.textContent=r.value}a();s()};var s=function(){for(var t=0;t<e.cells.length;t++){if(e.cells[t].value==undefined){return}}l()};var o=document.getElementsByClassName("available")[0];var u=function(e){a();if(e.element.textContent!==""){return}var t=o.getElementsByTagName("li");for(var n=0;n<t.length;n++){if(e.availableValues.indexOf(parseInt(n))>-1){t[n].className+=" enabled"}else{t[n].className+=" disabled"}}o.cell=e};(function(){var e=o.getElementsByTagName("li");for(var t=0;t<e.length;t++){e[t].addEventListener("click",function(){var e=this.attributes["class"];if(e&&e.value.indexOf("disabled")>0){return}if(o.cell){if(o.cell.originalValue===parseInt(this.textContent)){i(o.cell)}else{f()}}a()},false)}})();var a=function(){var e=o.getElementsByTagName("li");for(var t=0;t<e.length;t++){e[t].className=e[t].className.replace(" disabled","").replace(" enabled","")}try{delete o.cell}catch(exx){o.cell=undefined}};var f=function(){alert("Wrong move, try again.")};var l=function(){alert("Done!")};return{createBoard:t,autoComplete:r}}()
